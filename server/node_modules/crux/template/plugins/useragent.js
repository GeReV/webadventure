
var useragent = require('useragent');

// Actually do the user agent parsing
$.plugins.bind('request', function(done, handle) {
	handle.useragent = useragent.parse(handle.request.headers['user-agent']);
	process.nextTick(done);
});

// Add the isMobile method
useragent.Agent.prototype._isMobile = null;
useragent.Agent.prototype.isMobile = function() {
	if (this._isMobile === null) {
		try {
			this._isMobile = (
				this.family === 'Android' ||
				(this.os && this.os.family === 'iOS') ||
				this.family === 'IEMobile' ||
				this.family === 'Opera Mini' ||
				this.family === 'Opera Mobile' ||
				this.family === 'Blackberry'
			);
		} catch (e) {
			this._isMobile = false;
		}
	}
	return this._isMobile;
};

